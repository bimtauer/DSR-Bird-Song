<html>
<head>
    <meta charset="utf-8">
    <title>Find the bird!</title>

    <link href="../static/video-js/video-js.css" rel="stylesheet">
    <link href="../static/video-js/videojs.wavesurfer.css" rel="stylesheet">
    <link href="../static/video-js/videojs.record.css" rel="stylesheet">

    <script src="../static/video-js/video.js"></script>
    <script src="../static/video-js/RecordRTC.js"></script>
    <script src="../static/video-js/adapter.js"></script>
    <script src="../static/video-js/wavesurfer.js"></script>
    <script src="../static/video-js/wavesurfer.microphone.js"></script>
    <script src="../static/video-js/videojs.wavesurfer.js"></script>

    <script src="../static/video-js/videojs.record.js"></script>
    <script src="../static/video-js/browser-workarounds.js"></script>


    <style>
        /* change player background color */
        #myAudio {
            background-color: #9FD6BA;
        }
    </style>

</head>
<body>
    <h1>Which bird would it be?</h1>

    <audio id="myAudio" class="video-js vjs-default-skin"></audio>
    
    <script>
    function createDownoadElement(blobUrl) {
        const downloadEl = document.createElement('a');
        downloadEl.innerHTML = 'Identify';
        downloadEl.download = 'audio.webm';
        downloadEl.href = blobUrl;
        document.body.appendChild(downloadEl);
    };


    var options = {
        controls: true,
        width: 600,
        height: 300,
        fluid: false,
        plugins: {
            wavesurfer: {
                src: 'live',
                waveColor: '#36393b',
                progressColor: 'black',
                debug: true,
                cursorWidth: 1,
                msDisplayMax: 20,
                hideScrollbar: true
            },
            record: {
                audio: true,
                video: false,
                maxLength: 20,
                debug: true
            }
        }
    };
    // apply audio workarounds for certain browsers
    applyAudioWorkaround();
    // create player
    var player = videojs('myAudio', options, function() {
        // print version information at startup
        var msg = 'Using video.js ' + videojs.VERSION +
            ' with videojs-record ' + videojs.getPluginVersion('record') +
            ', videojs-wavesurfer ' + videojs.getPluginVersion('wavesurfer') +
            ', wavesurfer.js ' + WaveSurfer.VERSION + ' and recordrtc ' +
            RecordRTC.version;
        videojs.log(msg);
    });
    // error handling
    player.on('deviceError', function() {
        console.log('device error:', player.deviceErrorCode);
    });
    player.on('error', function(element, error) {
        console.error(error);
    });
    // user clicked the record button and started recording
    player.on('startRecord', function() {
        console.log('started recording!');
    });
    // user completed recording and stream is available
    player.on('finishRecord', function() {
        // the blob object contains the recorded data that
        // can be downloaded by the user, stored on server etc.
        console.log('finished recording: ', player.recordedData);
        const rec = player.recordedData;
        console.log(rec);
        createDownoadElement(URL.createObjectURL(rec));
    });
    </script>
</body>

<!--
    <div>
        <button id='record-button'>Record audio</button><br><br>
    </div>
    
    <div id="waveform"></div>
    
    <script src="https://unpkg.com/wavesurfer.js"></script>
    
    <script src="static/recordAudio.js"></script>

-->

</html>


